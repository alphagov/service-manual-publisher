<h1>
  <%= guide.latest_edition.try(:title) || "Create a Guide" %>
  <%= state_label(guide) %>
</h1>

<div class='well'>
  <%= form_for guide do |f| %>
    <fieldset class='meta'>
      <legend>Meta</legend>
      <div class='form-group'>
        <%= f.label :slug  %>
        <%= f.error_list :slug  %>
        <%= f.text_field :slug, class: 'input-md-12 form-control' %>
      </div>

      <%= f.fields_for :latest_edition do |editions_form| %>

        <div class='form-group'>
          <%= editions_form.label :related_discussion_title %>
          <%= editions_form.error_list :related_discussion_title %>
          <%= editions_form.text_field :related_discussion_title, class: 'input-md-12 form-control' %>
        </div>

        <div class='form-group'>
          <%= editions_form.label :related_discussion_href, "Link to related discussion" %>
          <%= editions_form.error_list :related_discussion_href %>
          <%= editions_form.text_field :related_discussion_href, class: 'input-md-12 form-control' %>
        </div>

        <div class='form-group'>
          <%= editions_form.label :publisher_title, "Published by" %>
          <%= editions_form.error_list :publisher_title %>
          <%= editions_form.select :publisher_title, Edition::PUBLISHERS.keys, class: 'input-md-12 form-control' %>
        </div>

        <div class='form-group'>
          <%= editions_form.label :phase %>
          <%= editions_form.error_list :phase %>
          <%= editions_form.select :phase, [['Alpha', 'alpha'], ['Beta', 'beta'], ['Live', 'live']], class: 'input-md-12 form-control' %>
        </div>

        <div class='form-group'>
          <%= editions_form.label :description %>
          <%= editions_form.error_list :description %>
          <%= editions_form.text_area :description, rows: 4, class: 'input-md-12 form-control' %>
        </div>
      <% end %>
    </fieldset>

    <fieldset class='inputs'>
      <legend>Content</legend>
      <%= f.fields_for :latest_edition do |editions_form| %>
        <div class="form-group">
          <%= editions_form.label :title %>
          <%= editions_form.error_list :title %>
          <%= editions_form.text_field :title, class: 'input-md-12 form-control' %>
        </div>
        <div class="form-group">
          <%= editions_form.label :body %>
          <%= editions_form.error_list :body %>
          <%= editions_form.text_area :body, class: 'input-md-12 form-control', rows: 14 %>
        </div>
      <% end %>

    </fieldset>

    <fieldset class='update'>
      <div class='form-group'>
        <%= f.fields_for :latest_edition do |editions_form| %>
          <div class='form-group'>
            <%= editions_form.label :update_type %>
            <%= editions_form.error_list :update_type %>
            <%= editions_form.select :update_type, [["Major", "major"], ["Minor", "minor"], ["Republish", "republish"]], include_blank: true, class: 'input-md-12 form-control' %>
          </div>
        <% end %>
      </div>
      <div class='form-group'>
        <%= f.submit "Save Draft", class: 'btn btn-success', name: :save_draft %>
        <%= link_to "Preview", document_preview_url(guide), class: 'btn btn-default' %>
        <% if guide.latest_edition.present? && guide.latest_edition.approved? %>
          <%= f.submit "Publish", class: 'btn btn-success', name: :publish %>
        <% end %>
      </div>
    </fieldset>
  <% end %>

  <% if guide.can_request_review? %>
    <%= form_for :review_request, url: edition_review_requests_path(edition_id: guide.latest_edition.id) do |f| %>
      <%= f.submit "Send for review", class: 'btn btn-success' %>
    <% end %>
  <% end %>
  <% if guide.can_mark_as_approved? %>
    <%= form_for Approval.new do |f| %>
      <fieldset class='meta'>
        <legend>Approve</legend>
        <%= f.hidden_field :edition_id, value: guide.latest_edition.id %>
        <%= f.submit "Mark as Approved", class: 'btn btn-success' %>
      </fieldset>
    <% end %>
  <% end %>

</div>

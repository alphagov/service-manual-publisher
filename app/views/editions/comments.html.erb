<%= render 'editions/header_with_navigation', edition: @edition, guide: @guide %>
<%= render 'editions/old_edition_alert', edition: @edition, guide: @guide %>

<%= guide_form_for @guide do |f| %>
  <%= render 'editions/actions', publish_controls_only: true, form: f, guide: @guide, edition: @edition %>
<% end %>

<% @latest_edition_per_edition_group.each do |latest_edition_of_group| %>
  <% if latest_edition_of_group == @edition %>
    <div class="open-edition panel panel-default">
      <div class="panel-heading">
        Version #<%= latest_edition_of_group.version %>
        <%= link_to "View changes", edition_changes_path(latest_edition_of_group) %>
      </div>
      <div class="panel-body">
        <%= render 'comment_form', comment: @comment, edition: latest_edition_of_group %>

        <% EditionThread.new(latest_edition_of_group).events.reverse.each do |event| %>
          <%= render "editions/#{event.class.to_s.underscore}", event: event %>
        <% end %>
      </div>
    </div>
  <% else %>
    <div class="panel panel-default">
      <div class="panel-heading">
        <%= link_to "Version ##{latest_edition_of_group.version}", edition_comments_path(latest_edition_of_group) %>
        <%= link_to "View changes", edition_changes_path(latest_edition_of_group) %>
      </div>
    </div>
  <% end %>
<% end %>

<%= guide_form_for @guide do |f| %>
  <%= render 'editions/actions', publish_controls_only: true, form: f, guide: @guide, edition: @edition %>
<% end %>
